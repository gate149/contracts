openapi: 3.0.3
info:
  title: CoreService API
  version: 0.0.1
paths:
  /problems:
    get:
      operationId: ListProblems
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
        - name: pageSize
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 10
        - name: title
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
          example: "Fibonacci"
          description: "Search problems by title using Typesense (full-text search with typo tolerance)"
        - name: order
          in: query
          schema:
            type: integer
            format: int32
            example: 1
        - name: owner
          in: query
          schema:
            type: string
          example: "me"
          description: "Filter by owner. Use 'me' to get user's private problems"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListProblemsResponseModel"
    post:
      operationId: CreateProblem
      parameters:
        - name: title
          in: query
          required: true
          schema:
            type: string
          example: "Problem 1"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreationResponseModel"
  /problems/{id}:
    get:
      operationId: GetProblem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetProblemResponseModel"
    delete:
      operationId: DeleteProblem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content: {}
    patch:
      operationId: UpdateProblem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProblemRequestModel"
      responses:
        "200":
          description: OK
          content: {}
    post:
      operationId: UploadProblem
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/UploadProblemRequestModel"
      responses:
        "200":
          description: OK
          content: {}

  /contests:
    get:
      operationId: ListContests
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
        - name: pageSize
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 10
        - name: title
          in: query
          schema:
            type: string
          example: "Contest"
        - name: owner
          in: query
          schema:
            type: string
          example: "me"
          description: "Filter by owner. Use 'me' to get user's private contests"
        - name: descending
          in: query
          schema:
            type: boolean
            default: false
          example: false
          description: "Sort order by creation date. true = newest first (DESC), false = oldest first (ASC)"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListContestsResponseModel"
    post:
      operationId: CreateContest
      parameters:
        - name: title
          in: query
          required: true
          schema:
            type: string
          example: "Contest 1"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreationResponseModel"
  /contests/{contest_id}:
    get:
      operationId: GetContest
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetContestResponseModel"
    delete:
      operationId: DeleteContest
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
    patch:
      operationId: UpdateContest
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateContestRequestModel"
      responses:
        "200":
          description: OK
  /contests/{contest_id}/problems:
    post:
      operationId: CreateContestProblem
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: problem_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreationResponseModel"
  /contests/{contest_id}/problems/{problem_id}:
    get:
      operationId: GetContestProblem
      parameters:
        - name: problem_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetContestProblemResponseModel"
    delete:
      operationId: DeleteContestProblem
      parameters:
        - name: problem_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
  /contests/{contest_id}/participants:
    get:
      operationId: ListParticipants
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
        - name: pageSize
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 10
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListUsersResponseModel"
    post:
      operationId: CreateParticipant
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: user_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreationResponseModel"
    delete:
      operationId: DeleteParticipant
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
  /solutions:
    post:
      operationId: CreateSolution
      parameters:
        - name: problem_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: contest_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: language
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/CreateSolutionRequestModel"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreationResponseModel"
    get:
      operationId: ListSolutions
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
        - name: pageSize
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 10
        - name: contestId
          in: query
          schema:
            type: string
            format: uuid
        - name: userId
          in: query
          schema:
            type: string
            format: uuid
        - name: problemId
          in: query
          schema:
            type: string
            format: uuid
        - name: state
          in: query
          schema:
            type: integer
            format: int32
          example: 1
        - name: order
          in: query
          schema:
            type: integer
            format: int32
          example: 1
        - name: language
          in: query
          schema:
            type: integer
            format: int32
          example: 1
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListSolutionsResponseModel"
  /solutions/{solution_id}:
    get:
      operationId: GetSolution
      parameters:
        - name: solution_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetSolutionResponseModel"
  /solutions/{solution_id}/test-results:
    get:
      operationId: GetTestResults
      parameters:
        - name: solution_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetTestResultsResponseModel"
  /contests/{contest_id}/monitor:
    get:
      operationId: GetMonitor
      parameters:
        - name: contest_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetMonitorResponseModel"
  /health:
    get:
      operationId: GetHealth
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  message:
                    type: string
                    example: "Backend is running"
  /users/me:
    get:
      operationId: GetMe
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserResponseModel"
  /users:
    get:
      operationId: GetUsers
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 1
        - name: pageSize
          in: query
          required: true
          schema:
            type: integer
            format: int32
          example: 10
        - name: search
          in: query
          schema:
            type: string
          example: "john"
        - name: role
          in: query
          schema:
            type: string
          example: "admin"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ListUsersResponseModel"
  /users/{id}:
    get:
      operationId: GetUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUserResponseModel"
  /permissions/check:
    post:
      operationId: CheckPermission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CheckPermissionRequestModel"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckPermissionResponseModel"
  /permissions/grant:
    post:
      operationId: GrantPermission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GrantPermissionRequestModel"
      responses:
        "200":
          description: OK
  /permissions/revoke:
    post:
      operationId: RevokePermission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RevokePermissionRequestModel"
      responses:
        "200":
          description: OK
components:
  schemas:
    CreationResponseModel:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          format: uuid
    PaginationModel:
      type: object
      required:
        - page
        - total
      properties:
        page:
          type: integer
          format: int32
          example: 1
        total:
          type: integer
          format: int32
          example: 10
    ProblemModel:
      type: object
      required:
        - id
        - title
        - time_limit
        - memory_limit

        - legend
        - input_format
        - output_format
        - notes
        - scoring

        - legend_html
        - input_format_html
        - output_format_html
        - notes_html
        - scoring_html

        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: "Test problem"
        time_limit:
          type: integer
          format: int32
          example: 1000
        memory_limit:
          type: integer
          format: int32
          example: 256

        legend:
          type: string
        input_format:
          type: string
        output_format:
          type: string
        notes:
          type: string
        scoring:
          type: string

        legend_html:
          type: string
        input_format_html:
          type: string
        output_format_html:
          type: string
        notes_html:
          type: string
        scoring_html:
          type: string

        is_private:
          type: boolean
          example: true

        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ProblemsListItemModel:
      type: object
      required:
        - id
        - title
        - memory_limit
        - time_limit
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        memory_limit:
          type: integer
          format: int32
        time_limit:
          type: integer
          format: int32
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ListProblemsResponseModel:
      type: object
      required:
        - problems
        - pagination
      properties:
        problems:
          type: array
          items:
            $ref: "#/components/schemas/ProblemsListItemModel"
        pagination:
          $ref: "#/components/schemas/PaginationModel"
    GetProblemResponseModel:
      type: object
      required:
        - problem
      properties:
        problem:
          $ref: "#/components/schemas/ProblemModel"
    ContestProblemModel:
      type: object
      required:
        - problem_id
        - title
        - time_limit
        - memory_limit

        - position

        - legend_html
        - input_format_html
        - output_format_html
        - notes_html
        - scoring_html

        - created_at
        - updated_at
      properties:
        problem_id:
          type: string
          format: uuid
        title:
          type: string
          example: "Test problem"
        time_limit:
          type: integer
          format: int32
          example: 1000
        memory_limit:
          type: integer
          format: int32
          example: 256

        position:
          type: integer
          format: int32

        legend_html:
          type: string
        input_format_html:
          type: string
        output_format_html:
          type: string
        notes_html:
          type: string
        scoring_html:
          type: string

        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    GetContestProblemResponseModel:
      type: object
      required:
        - problem
      properties:
        problem:
          $ref: "#/components/schemas/ContestProblemModel"
    ContestModel:
      type: object
      required:
        - id
        - title
        - is_private
        - monitor_enabled
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: "Test contest"
        is_private:
          type: boolean
          example: true
        monitor_enabled:
          type: boolean
          example: false
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ListContestsResponseModel:
      type: object
      required:
        - contests
        - pagination
      properties:
        contests:
          type: array
          items:
            $ref: "#/components/schemas/ContestModel"
        pagination:
          $ref: "#/components/schemas/PaginationModel"
    ContestProblemListItemModel:
      type: object
      required:
        - problem_id
        - position
        - title
        - memory_limit
        - time_limit
        - created_at
        - updated_at
      properties:
        problem_id:
          type: string
          format: uuid
        position:
          type: integer
          format: int32
        title:
          type: string
          example: "Test task"
        memory_limit:
          type: integer
          format: int32
          example: 256
        time_limit:
          type: integer
          format: int32
          example: 1000
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    GetContestResponseModel:
      type: object
      required:
        - contest
        - problems
      properties:
        contest:
          $ref: "#/components/schemas/ContestModel"
        problems:
          type: array
          items:
            $ref: "#/components/schemas/ContestProblemListItemModel"
    UpdateProblemRequestModel:
      type: object
      properties:
        title:
          type: string
          example: "Test problem"
        legend:
          type: string
        input_format:
          type: string
        output_format:
          type: string
        notes:
          type: string
        scoring:
          type: string
        memory_limit:
          type: integer
          format: int32
          example: 256
        time_limit:
          type: integer
          format: int32
          example: 1000
        is_private:
          type: boolean
          example: true
    UploadProblemRequestModel:
      type: object
      required:
        - archive
      properties:
        archive:
          type: string
          format: binary
    UpdateContestRequestModel:
      type: object
      properties:
        title:
          type: string
          example: "Test contest"
        is_private:
          type: boolean
          example: true
        monitor_enabled:
          type: boolean
          example: false
    CreateSolutionRequestModel:
      type: object
      required:
        - solution
      properties:
        solution:
          type: string
          format: binary
    ListSolutionsResponseModel:
      type: object
      required:
        - solutions
        - pagination
      properties:
        access-token:
          type: string
        solutions:
          type: array
          items:
            $ref: "#/components/schemas/SolutionsListItemModel"
        pagination:
          $ref: "#/components/schemas/PaginationModel"
    SolutionsListItemModel:
      type: object
      required:
        - id

        - user_id
        - username

        - state
        - score
        - penalty
        - time_stat
        - memory_stat
        - language

        - problem_id
        - problem_title

        - position

        - contest_id
        - contest_title

        - updated_at
        - created_at
      properties:
        id:
          type: string
          format: uuid

        user_id:
          type: string
          format: uuid
        username:
          type: string
          example: "user123"

        state:
          type: integer
          format: int32
          example: 1
        score:
          type: integer
          format: int32
          example: 100
        penalty:
          type: integer
          format: int32
          example: 28
        time_stat:
          type: integer
          format: int32
          example: 1000
        memory_stat:
          type: integer
          format: int32
          example: 256
        language:
          type: integer
          format: int32
          example: 1

        problem_id:
          type: string
          format: uuid
        problem_title:
          type: string
          example: "Task title"

        position:
          type: integer
          format: int32
          example: 1

        contest_id:
          type: string
          format: uuid
        contest_title:
          type: string
          example: "Contest title"

        updated_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
    SolutionModel:
      type: object
      required:
        - id

        - user_id
        - username

        - solution

        - state
        - score
        - penalty
        - time_stat
        - memory_stat
        - language

        - problem_id
        - problem_title

        - position

        - contest_id
        - contest_title

        - updated_at
        - created_at
      properties:
        id:
          type: string
          format: uuid

        user_id:
          type: string
          format: uuid
        username:
          type: string
          example: "user123"

        solution:
          type: string
          example: 'print("Hello, world!")'

        state:
          type: integer
          format: int32
          example: 1
        score:
          type: integer
          format: int32
          example: 100
        penalty:
          type: integer
          format: int32
          example: 28
        time_stat:
          type: integer
          format: int32
          example: 1000
        memory_stat:
          type: integer
          format: int32
          example: 256
        language:
          type: integer
          format: int32
          example: 1

        problem_id:
          type: string
          format: uuid
        problem_title:
          type: string
          example: "Task title"

        position:
          type: integer
          format: int32
          example: 1

        contest_id:
          type: string
          format: uuid
        contest_title:
          type: string
          example: "Contest title"

        updated_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
    GetSolutionResponseModel:
      type: object
      required:
        - solution
      properties:
        solution:
          $ref: "#/components/schemas/SolutionModel"
    GetMonitorResponseModel:
      type: object
      required:
        - participants
        - summary
      properties:
        participants:
          type: array
          items:
            $ref: "#/components/schemas/ParticipantsStatModel"
        summary:
          type: array
          items:
            $ref: "#/components/schemas/ProblemStatSummaryModel"
    ProblemStatSummaryModel:
      type: object
      required:
        - problem_id
        - position
        - s_attempts
        - f_attempts
        - t_attempts
      properties:
        problem_id:
          type: string
          format: uuid
        position:
          type: integer
          format: int32
          example: 1
        s_attempts:
          type: integer
          format: int32
          example: 1
        f_attempts:
          type: integer
          format: int32
          example: 1
        t_attempts:
          type: integer
          format: int32
          example: 1
    ParticipantsStatModel:
      type: object
      required:
        - user_id
        - username
        - solved
        - penalty
        - attempts
      properties:
        user_id:
          type: string
          format: uuid
        username:
          type: string
          example: "user123"
        solved:
          type: integer
          format: int32
          example: 1
        penalty:
          type: integer
          format: int32
          example: 28
        attempts:
          type: array
          items:
            $ref: "#/components/schemas/ProblemAttemptsModel"
    ProblemAttemptsModel:
      type: object
      required:
        - problem_id
        - failed_attempts
        - state
        - position
      properties:
        problem_id:
          type: string
          format: uuid
          example: 1
        position:
          type: integer
          format: int32
          example: 1
        failed_attempts:
          type: integer
          format: int32
          example: 1
        state:
          type: integer
          format: int32
          nullable: true
          example: 1
    GetUserResponseModel:
      type: object
      required:
        - user
      properties:
        user:
          $ref: "#/components/schemas/UserModel"
    UserModel:
      type: object
      required:
        - id
        - username
        - createdAt
        - updatedAt
        - role
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
          example: user123
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        role:
          type: string
    ListUsersResponseModel:
      type: object
      required:
        - users
        - pagination
      properties:
        users:
          type: array
          items:
            $ref: "#/components/schemas/UserModel"
        pagination:
          $ref: "#/components/schemas/PaginationModel"
    TestResultModel:
      type: object
      required:
        - id
        - solution_id
        - test_name
        - test_number
        - passed
        - verdict
        - time_ms
        - memory_kb
        - created_at
      properties:
        id:
          type: string
          format: uuid
        solution_id:
          type: string
          format: uuid
        test_name:
          type: string
          example: "01"
        test_number:
          type: integer
          format: int32
          example: 1
        passed:
          type: boolean
        verdict:
          type: integer
          format: int32
          example: 200
        time_ms:
          type: integer
          format: int32
          example: 150
          description: "Execution time in milliseconds"
        memory_kb:
          type: integer
          format: int32
          example: 2048
          description: "Memory usage in kilobytes"
        stdout:
          type: string
          nullable: true
        stderr:
          type: string
          nullable: true
        compile_output:
          type: string
          nullable: true
        message:
          type: string
          nullable: true
        group_id:
          type: integer
          format: int32
          nullable: true
        group_name:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
    GetTestResultsResponseModel:
      type: object
      required:
        - test_results
      properties:
        test_results:
          type: array
          items:
            $ref: "#/components/schemas/TestResultModel"
    CheckPermissionRequestModel:
      type: object
      required:
        - resource_type
        - resource_id
        - permission
      properties:
        resource_type:
          type: string
          example: "contest"
          description: "Type of resource (contest, problem, etc.)"
        resource_id:
          type: string
          format: uuid
          description: "ID of the resource"
        permission:
          type: string
          example: "view"
          description: "Permission to check (view, edit, admin)"
    CheckPermissionResponseModel:
      type: object
      required:
        - allowed
      properties:
        allowed:
          type: boolean
          example: true
          description: "Whether the user has the requested permission"
    GrantPermissionRequestModel:
      type: object
      required:
        - resource_type
        - resource_id
        - user_id
        - relation
      properties:
        resource_type:
          type: string
          example: "contest"
          description: "Type of resource (contest, problem, etc.)"
        resource_id:
          type: string
          format: uuid
          description: "ID of the resource"
        user_id:
          type: string
          format: uuid
          description: "ID of the user to grant permission to"
        relation:
          type: string
          example: "owner"
          description: "Relation/role to grant (owner, editor, viewer)"
    RevokePermissionRequestModel:
      type: object
      required:
        - resource_type
        - resource_id
        - user_id
        - relation
      properties:
        resource_type:
          type: string
          example: "contest"
          description: "Type of resource (contest, problem, etc.)"
        resource_id:
          type: string
          format: uuid
          description: "ID of the resource"
        user_id:
          type: string
          format: uuid
          description: "ID of the user to revoke permission from"
        relation:
          type: string
          example: "owner"
          description: "Relation/role to revoke (owner, editor, viewer)"
